**`create_leveling_engine.md`**

This version includes:

* full leveling specification
* stat computation rules
* promotion/demotion logic
* how to integrate with existing GameScreen state
* deliverables clearly defined

Your coding agent will be able to generate all structures, hooks, and logic from this.

---

# **create_leveling_engine.md**

**Task ID:** `T_CREATE_LEVELING_ENGINE`
**Goal:** Implement a fully automated leveling system that adapts difficulty based on the user‚Äôs real-time performance data (accuracy, fluency, error density, consistency). The system should promote/demote the learner between levels 1‚Äì5 based on mastery criteria.

---

# üìù **Task Summary**

The app must now include a **Leveling Engine** that determines the learner‚Äôs current difficulty level based on actual gameplay stats. This leveling engine must:

1. Track the user‚Äôs performance continuously.
2. Calculate derived statistics (accuracy, fluency, error density, consistency).
3. Use well-defined criteria to decide when to level-up or level-down.
4. Change gameplay behavior according to the current level (visual cues, case variants, syllabification, motor guidance, etc.).
5. Persist the current level and provide it to the UI so components can adapt.

---

# üéÆ **LEVEL DEFINITIONS**

The engine must implement **five levels**, each corresponding to increased orthographic and motor independence.

---

## **LEVEL 1 ‚Äî Concept Level**

**Gameplay features:**

* Show emoji/image
* Show **one** version of the word
* Highlight next key on keyboard
* Standard tile spelling

**Level-up requirements:**

* ‚â• 95% accuracy over last 20 words
* ‚â§ 2 wrong-key presses per word average
* ‚â§ 1 retry per 10 words

---

## **LEVEL 2 ‚Äî Print Variability**

**Gameplay features:**

* Show 3‚Äì5 variants:

  * lowercase
  * uppercase
  * title case
  * monospace
  * serif
* Continue showing picture/sign
* Light key guidance remains

**Level-up requirements:**

* ‚â• 90% accuracy
* Avg ‚â§ 1.5 wrong-key presses
* Median word time improving (20% faster than baseline)
* Complete ‚â• 50 unique emoji words

---

## **LEVEL 3 ‚Äî Orthographic Complexity**

**Gameplay features:**

* All variants from Level 2
* Add syllabified forms: ‚Äúmon-key‚Äù, ‚Äúmon¬∑key¬∑face‚Äù
* Add spaced-out variants: ‚Äúm o n k e y‚Äù

**Level-up requirements:**

* ‚â• 90% accuracy over 40 consecutive words
* Avg ‚â§ 1 wrong-key press
* Consistency Score ‚â• 85% (first-try correctness rate)

---

## **LEVEL 4 ‚Äî Motor Independence**

**Gameplay features:**

* No key highlighting
* Tiles appear blank before correct press
* Word variants shown small for recognition

**Level-up requirements:**

* ‚â• 85% first-try accuracy
* Avg ‚â§ 1 wrong-key press
* Accuracy on similar words ‚â• 80%

---

## **LEVEL 5 ‚Äî Generalization**

**Gameplay features:**

* Emoji/image may be hidden or briefly flashed
* All print variants active
* Full randomization
* Blank tiles
* No motor guidance

**Staying at Level 5 requires:**

* ‚â• 80% accuracy
* Stable completion time
* No ‚Äúcatastrophic failures‚Äù (‚â•3 failed attempts on a single word)

**Demotion rule:**
If accuracy < 70% over last 15 words ‚Üí go back to Level 4.

---

# üìä **METRICS TO IMPLEMENT**

The agent must implement these metrics in the leveling engine.

---

## **1. Accuracy Stability Index (ASI)**

```
ASI = (first_try_correct / total_recent_words) √ó 100
```

---

## **2. Motor Fluency Score (MFS)**

```
MFS = 1 - (wrong_key_presses / total_key_presses)
```

Goal varies by level (0.8 for L2‚ÄìL3, 0.85+ for L4‚ÄìL5).

---

## **3. Error Density**

```
error_density = wrong_key_presses / word_length
```

Goal:
‚â§ 0.3 for L3
‚â§ 0.1 for L4‚ÄìL5

---

## **4. Consistency Score**

```
consistency = first_try_correct_words / total_words_window
```

---

## **5. Difficulty Score (Optional)**

```
difficulty_score = (time / avg_time) + (errors √ó 0.5)
```

Used for generalization/challenge detection.

---

# üß© **ENGINE ARCHITECTURE REQUIREMENTS**

The agent must implement:

### **A. A new file:**

```
src/engine/LevelingEngine.ts
```

### Export a class or hook:

```ts
export function useLevelingEngine() {
  return {
    level,
    recordResult(result),
    getCurrentLevel(),
    getActiveFeatures(),
  };
}
```

Where `result` includes:

```ts
{
  wordId: string;
  correct: boolean;
  wrongKeyPresses: number;
  firstTryCorrect: boolean;
  timeToComplete: number;
  wordLength: number;
}
```

---

### **B. Persistent State**

Use:

* localStorage, or
* dedicated global store (Zustand, Redux), or
* Context-based persistence

The agent may choose the cleanest solution.

---

### **C. Level Promotion Logic**

The engine must automatically:

* Evaluate the last N words (N depends on level)
* Check if criteria met
* Promote to next level
* Debounce rapid promotion (minimum 10-word buffer)

---

### **D. Level Demotion Logic**

Conditions for demotion:

* Accuracy drop > threshold
* Excessive wrong-key presses
* Catastrophic failure event (3+ failed attempts)

Engine must gracefully drop the learner back one level.

---

### **E. Feature Flags**

Return active features based on level:

```ts
{
  showKeyHighlights: boolean,
  showWordVariants: boolean,
  showSyllables: boolean,
  allowBlankTiles: boolean,
  hideEmojiAfterDelay: boolean,
}
```

These flags should be consumed by:

* WordCard
* Keyboard
* TileRow
* Emoji/Image display
* Any new components (syllables, variants, etc.)

---

# üîó **INTEGRATION INTO GAMEPLAY**

The agent must modify:

### **1. GameScreen**

After each word completion, call:

```ts
levelingEngine.recordResult(gameStatsForThisWord)
```

### **2. WordCard**

Customize display based on `levelingEngine.getActiveFeatures()`.

### **3. Keyboard**

Show/hide key guidance depending on level.

### **4. Word Variants Component**

Appear only at Level ‚â• 2.

---

# üß™ **ACCEPTANCE CRITERIA**

This task is complete when:

1. A working leveling engine exists with five strict levels.
2. Promotion/demotion works automatically based on real stats.
3. The engine exposes clear feature flags.
4. GameScreen uses those flags to adapt gameplay.
5. WordCard shows the correct variants/syllables when appropriate.
6. Keyboard guidance fades out in L4‚ÄìL5.
7. Emoji flashing/hiding works at L5.
8. Level persists between sessions.
9. A basic test suite exists (unit tests or logic validation).

---

# üì¶ **DELIVERABLES**

* `src/engine/LevelingEngine.ts`
* Updated GameScreen
* Updated WordCard
* Updated Keyboard
* Word variants component
* Syllable variants logic
* Documentation within the file
